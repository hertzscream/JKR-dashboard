<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Analytics Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            primary: '#3b82f6',
                            secondary: '#6366f1',
                            dark: '#0f172a',
                            surface: '#1e293b'
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;600;700&family=Sarabun:wght@300;400;600&display=swap');
        
        body { 
            font-family: 'Sarabun', sans-serif;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .header-font { font-family: 'Chakra Petch', sans-serif; }

        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }
        .dark .glass {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        .pulse {
            animation: pulse-animation 2s infinite;
        }
        @keyframes pulse-animation {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(59, 130, 246, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }

        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 10px; }
    </style>
</head>
<body class="bg-[#f8fafc] text-slate-900 dark:bg-[#020617] dark:text-slate-100 min-h-screen custom-scrollbar">
    <div id="root"></div>

    <script>
        const { useState, useEffect, useMemo } = React;
        const e = React.createElement;
        const { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, BarChart, Bar, Cell, Legend } = window.Recharts;

        // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸—à¸µà¹ˆà¸”à¸¶à¸‡à¸¡à¸²à¸ˆà¸²à¸à¹„à¸Ÿà¸¥à¹Œà¸—à¸µà¹ˆà¸­à¸±à¸›à¹‚à¸«à¸¥à¸” (Embed)
        const INITIAL_CSV = `(à¸§à¸±à¸™à¸—à¸µà¹ˆ),(à¹€à¸§à¸¥à¸²à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸”à¸±à¸š),(à¹€à¸§à¸¥à¸²à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸•à¸´à¸”),(à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²à¸—à¸µà¹ˆà¸”à¸±à¸š),(à¸”à¸±à¸šà¸ªà¸°à¸ªà¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”)
27/01/2026,16:57:02,16:57:20,0:00:17,0:00:17
27/01/2026,16:59:00,16:59:09,0:00:08,0:00:26
28/01/2026,10:16:15,10:17:29,0:01:14,0:01:40
28/01/2026,10:17:52,10:18:03,0:00:11,0:01:51
28/01/2026,-,11:20:01,0:47:11,0:49:03
28/01/2026,11:21:18,11:21:48,0:00:30,0:49:33
28/01/2026,11:23:33,11:27:07,0:03:34,0:53:07
28/01/2026,11:48:07,11:50:59,0:02:52,0:56:00
29/01/2026,08:05:41,08:06:55,0:01:14,0:57:14
29/01/2026,08:35:10,08:35:45,0:00:35,0:57:49
29/01/2026,08:39:10,08:42:01,0:02:51,1:00:40
30/01/2026,09:15:00,09:20:00,0:05:00,1:05:40`;

        const parseTime = (str) => {
            if (!str || str === '-' || typeof str !== 'string') return 0;
            const p = str.trim().split(':').map(Number);
            if (p.length === 3) return (p[0] * 3600 + p[1] * 60 + p[2]);
            if (p.length === 2) return (p[0] * 60 + p[1]);
            return 0;
        };

        const formatDuration = (sec) => {
            if (isNaN(sec) || sec === 0) return "0 à¸§.";
            const h = Math.floor(sec / 3600);
            const m = Math.floor((sec % 3600) / 60);
            const s = sec % 60;
            return h > 0 ? `${h}à¸Šà¸¡. ${m}à¸™.` : m > 0 ? `${m}à¸™. ${s}à¸§.` : `${s}à¸§.`;
        };

        const convertDateFormat = (thaiDate) => {
            if (!thaiDate || !thaiDate.includes('/')) return '';
            const parts = thaiDate.split('/');
            if (parts.length !== 3) return '';
            const [d, m, y] = parts;
            return `${y}-${m.padStart(2, '0')}-${d.padStart(2, '0')}`;
        };

        function App() {
            const [data, setData] = useState([]);
            const [darkMode, setDarkMode] = useState(true);
            const [startDate, setStartDate] = useState('');
            const [endDate, setEndDate] = useState('');

            useEffect(() => {
                if (darkMode) document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            }, [darkMode]);

            const processCSVData = (text) => {
                try {
                    const rows = text.split(/\r?\n/).filter(r => r.trim());
                    if (rows.length < 2) return;
                    
                    const parsed = rows.slice(1).map((row, idx) => {
                        const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c => c.trim().replace(/"/g, ''));
                        return {
                            id: idx,
                            date: cols[0],
                            isoDate: convertDateFormat(cols[0]),
                            stop: cols[1],
                            start: cols[2],
                            dur: cols[3],
                            cum: cols[4],
                            durSec: parseTime(cols[3])
                        };
                    }).filter(item => item.isoDate !== '');

                    setData(parsed);
                    
                    if (parsed.length > 0) {
                        const sorted = [...parsed].sort((a, b) => a.isoDate.localeCompare(b.isoDate));
                        setStartDate(sorted[0].isoDate);
                        setEndDate(sorted[sorted.length - 1].isoDate);
                    }
                } catch (err) {
                    console.error("Parse error:", err);
                }
            };

            useEffect(() => {
                processCSVData(INITIAL_CSV);
            }, []);

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (evt) => processCSVData(evt.target.result);
                reader.readAsText(file);
            };

            const filteredData = useMemo(() => {
                return data.filter(item => {
                    return (!startDate || item.isoDate >= startDate) && (!endDate || item.isoDate <= endDate);
                }).sort((a, b) => a.isoDate.localeCompare(b.isoDate));
            }, [data, startDate, endDate]);

            const stats = useMemo(() => {
                const totalSec = filteredData.reduce((acc, curr) => acc + curr.durSec, 0);
                const maxSec = filteredData.length > 0 ? Math.max(...filteredData.map(d => d.durSec)) : 0;
                return {
                    count: filteredData.length,
                    total: formatDuration(totalSec),
                    avg: formatDuration(filteredData.length > 0 ? Math.round(totalSec / filteredData.length) : 0),
                    max: formatDuration(maxSec)
                };
            }, [filteredData]);

            const dailyData = useMemo(() => {
                const groups = filteredData.reduce((acc, item) => {
                    acc[item.date] = (acc[item.date] || 0) + item.durSec;
                    return acc;
                }, {});
                return Object.keys(groups).map(date => ({ date, total: groups[date] }));
            }, [filteredData]);

            return e('div', { className: "max-w-[1400px] mx-auto p-4 md:p-8 space-y-8" }, [
                
                // --- Header ---
                e('header', { className: "flex flex-col md:flex-row justify-between items-start md:items-center gap-6" }, [
                    e('div', null, [
                        e('div', { className: "flex items-center gap-3 mb-1" }, [
                            e('div', { className: "w-3 h-3 rounded-full bg-emerald-500 pulse" }),
                            e('h1', { className: "header-font text-3xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-500 dark:from-blue-400 dark:to-emerald-400" }, "GENERATOR LOG ANALYTICS")
                        ]),
                        e('p', { className: "text-slate-500 dark:text-slate-400 text-sm" }, "à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸ˆà¸²à¸à¹„à¸Ÿà¸¥à¹Œ Gen Log")
                    ]),
                    
                    e('div', { className: "flex flex-wrap items-center gap-3 w-full md:w-auto" }, [
                        e('label', { className: "flex-1 md:flex-none glass px-4 py-2.5 rounded-2xl text-xs font-bold cursor-pointer hover:bg-blue-50 dark:hover:bg-slate-700 transition flex items-center justify-center gap-2 border border-blue-200 dark:border-slate-700" }, [
                            "ðŸ“‚ à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”à¹„à¸Ÿà¸¥à¹Œà¹ƒà¸«à¸¡à¹ˆ",
                            e('input', { type: 'file', accept: '.csv', className: 'hidden', onChange: handleFileUpload })
                        ]),
                        e('div', { className: "glass flex items-center gap-2 px-4 py-2 rounded-2xl border border-slate-200 dark:border-slate-700" }, [
                            e('input', { 
                                type: 'date', 
                                value: startDate, 
                                onChange: (e) => setStartDate(e.target.value),
                                className: "bg-transparent text-xs outline-none dark:text-white"
                            }),
                            e('span', { className: "text-slate-400" }, "â†’"),
                            e('input', { 
                                type: 'date', 
                                value: endDate, 
                                onChange: (e) => setEndDate(e.target.value),
                                className: "bg-transparent text-xs outline-none dark:text-white"
                            }),
                        ]),
                        e('button', { 
                            onClick: () => setDarkMode(!darkMode),
                            className: "p-3 rounded-2xl glass hover:bg-white dark:hover:bg-slate-700 transition"
                        }, darkMode ? "â˜€ï¸" : "ðŸŒ™")
                    ])
                ]),

                // --- Summary Cards ---
                e('div', { className: "grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6" }, [
                    { label: "à¸ˆà¸³à¸™à¸§à¸™à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸”à¸±à¸š", val: stats.count, unit: "à¸„à¸£à¸±à¹‰à¸‡", color: "from-blue-600 to-blue-400" },
                    { label: "à¹€à¸§à¸¥à¸²à¸£à¸§à¸¡à¸—à¸µà¹ˆà¸«à¸¢à¸¸à¸”à¸—à¸³à¸‡à¸²à¸™", val: stats.total, unit: "", color: "from-indigo-600 to-purple-500" },
                    { label: "à¸„à¹ˆà¸²à¹€à¸‰à¸¥à¸µà¹ˆà¸¢à¸•à¹ˆà¸­à¸„à¸£à¸±à¹‰à¸‡", val: stats.avg, unit: "", color: "from-emerald-600 to-teal-500" },
                    { label: "à¸«à¸¢à¸¸à¸”à¸™à¸²à¸™à¸—à¸µà¹ˆà¸ªà¸¸à¸”", val: stats.max, unit: "", color: "from-rose-600 to-orange-500" }
                ].map(s => e('div', { key: s.label, className: `p-6 rounded-[2.5rem] bg-gradient-to-br ${s.color} text-white shadow-2xl shadow-blue-500/10` }, [
                    e('p', { className: "text-white/70 text-[10px] font-bold uppercase tracking-widest mb-2" }, s.label),
                    e('h3', { className: "header-font text-2xl font-bold" }, s.val),
                    e('p', { className: "text-xs text-white/50" }, s.unit)
                ]))),

                // --- Charts Area ---
                e('div', { className: "grid grid-cols-1 lg:grid-cols-3 gap-6" }, [
                    // Area Chart - Timeline
                    e('div', { className: "lg:col-span-2 glass p-8 rounded-[3rem]" }, [
                        e('h3', { className: "header-font font-bold mb-8 dark:text-white text-lg" }, "Timeline: à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²à¸à¸²à¸£à¸”à¸±à¸šà¹à¸•à¹ˆà¸¥à¸°à¸„à¸£à¸±à¹‰à¸‡ (à¸§à¸´à¸™à¸²à¸—à¸µ)"),
                        e('div', { className: "h-[350px] w-full" }, e(ResponsiveContainer, null, e(AreaChart, { data: filteredData }, [
                            e('defs', null, e('linearGradient', { id: "colorTrend", x1: "0", y1: "0", x2: "0", y2: "1" }, [
                                e('stop', { offset: "5%", stopColor: "#3b82f6", stopOpacity: 0.4 }),
                                e('stop', { offset: "95%", stopColor: "#3b82f6", stopOpacity: 0 })
                            ])),
                            e(CartesianGrid, { strokeDasharray: "3 3", vertical: false, stroke: darkMode ? "#334155" : "#e2e8f0" }),
                            e(XAxis, { dataKey: "stop", fontSize: 10, tick: {fill: "#94a3b8"}, axisLine: false }),
                            e(YAxis, { fontSize: 10, tick: {fill: "#94a3b8"}, axisLine: false }),
                            e(Tooltip, { 
                                contentStyle: { backgroundColor: darkMode ? '#1e293b' : '#fff', borderRadius: '20px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)' },
                                formatter: (v) => [formatDuration(v), "à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²"]
                            }),
                            e(Area, { type: "monotone", dataKey: "durSec", stroke: "#3b82f6", strokeWidth: 4, fill: "url(#colorTrend)" })
                        ])))
                    ]),
                    // Bar Chart - Daily Summary
                    e('div', { className: "glass p-8 rounded-[3rem] flex flex-col" }, [
                        e('h3', { className: "header-font font-bold mb-8 dark:text-white text-lg" }, "à¸ªà¸£à¸¸à¸›à¹€à¸§à¸¥à¸²à¸£à¸§à¸¡à¸£à¸²à¸¢à¸§à¸±à¸™"),
                        e('div', { className: "flex-1 min-h-[300px]" }, e(ResponsiveContainer, null, e(BarChart, { data: dailyData }, [
                            e(XAxis, { dataKey: "date", fontSize: 10, tick: {fill: "#94a3b8"}, axisLine: false }),
                            e(Tooltip, { 
                                cursor: {fill: 'rgba(59, 130, 246, 0.1)'},
                                contentStyle: { backgroundColor: darkMode ? '#1e293b' : '#fff', border: 'none', borderRadius: '15px' },
                                formatter: (v) => [formatDuration(v), "à¸£à¸§à¸¡"]
                            }),
                            e(Bar, { dataKey: "total", fill: "#6366f1", radius: [12, 12, 12, 12] })
                        ])))
                    ])
                ]),

                // --- Detailed Table ---
                e('div', { className: "glass rounded-[3rem] overflow-hidden shadow-2xl border border-white/20 dark:border-slate-800" }, [
                    e('div', { className: "p-8 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center" }, [
                        e('h3', { className: "header-font font-bold dark:text-white" }, "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸à¸²à¸£à¸šà¸±à¸™à¸—à¸¶à¸ (Log Details)"),
                        e('span', { className: "text-xs text-slate-400 font-bold" }, `à¹à¸ªà¸”à¸‡à¸œà¸¥ ${filteredData.length} à¸£à¸²à¸¢à¸à¸²à¸£`)
                    ]),
                    e('div', { className: "overflow-x-auto" }, e('table', { className: "w-full text-left" }, [
                        e('thead', { className: "bg-slate-50/50 dark:bg-slate-900/50 text-[11px] text-slate-400 font-bold uppercase tracking-[0.2em]" }, e('tr', null, 
                            ['à¸§à¸±à¸™à¸—à¸µà¹ˆ', 'à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸”à¸±à¸š', 'à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸•à¸´à¸”', 'à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²', 'à¸ªà¸°à¸ªà¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”', 'à¸ªà¸–à¸²à¸™à¸°'].map(h => e('th', { className: "px-10 py-6" }, h))
                        )),
                        e('tbody', { className: "divide-y divide-slate-100 dark:divide-slate-800" }, filteredData.slice().reverse().map(r => e('tr', { key: r.id, className: "hover:bg-blue-50/20 dark:hover:bg-blue-900/10 transition-colors" }, [
                            e('td', { className: "px-10 py-5 text-sm font-semibold" }, r.date),
                            e('td', { className: "px-10 py-5 text-sm text-slate-500" }, r.stop),
                            e('td', { className: "px-10 py-5 text-sm text-slate-500" }, r.start),
                            e('td', { className: "px-10 py-5 text-sm font-bold text-rose-500" }, r.dur),
                            e('td', { className: "px-10 py-5 text-sm font-bold text-blue-500" }, r.cum),
                            e('td', { className: "px-10 py-5" }, 
                                e('span', { className: `px-4 py-1.5 rounded-xl text-[10px] font-bold ${r.durSec > 60 ? 'bg-rose-100 text-rose-600 dark:bg-rose-900/30' : 'bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30'}` }, 
                                    r.durSec > 60 ? 'HIGH' : 'LOW'
                                )
                            )
                        ])))
                    ]))
                ]),

                e('footer', { className: "text-center py-12 opacity-30 text-[10px] font-bold tracking-[0.8em]" }, "GENERATOR LOG ANALYTICS â€¢ DATA INSIGHTS")
            ]);
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(e(App));
    </script>
</body>
</html>
