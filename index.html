<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Analytics Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            primary: '#3b82f6',
                            secondary: '#6366f1',
                            dark: '#0f172a',
                            surface: '#1e293b'
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;600;700&family=Sarabun:wght@300;400;600&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .header-font { font-family: 'Chakra Petch', sans-serif; }
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .dark .glass {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .pulse { animation: pulse-animation 2s infinite; }
        @keyframes pulse-animation {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(59, 130, 246, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
    </style>
</head>
<body class="bg-[#f8fafc] text-slate-900 dark:bg-[#020617] dark:text-slate-100 min-h-screen transition-colors duration-300">
    <div id="root"></div>

    <script>
        const { useState, useEffect, useMemo } = React;
        const e = React.createElement;
        const { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, BarChart, Bar } = window.Recharts;

        // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸ˆà¸²à¸à¹„à¸Ÿà¸¥à¹Œ CSV à¸‚à¸­à¸‡à¸„à¸¸à¸“
        const INITIAL_CSV = `(à¸§à¸±à¸™à¸—à¸µà¹ˆ),(à¹€à¸§à¸¥à¸²à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸”à¸±à¸š),(à¹€à¸§à¸¥à¸²à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸•à¸´à¸”),(à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²à¸—à¸µà¹ˆà¸”à¸±à¸š),(à¸”à¸±à¸šà¸ªà¸°à¸ªà¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”)
27/01/2026,16:57:02,16:57:20,0:00:17,0:00:17
27/01/2026,16:59:00,16:59:09,0:00:08,0:00:26
28/01/2026,10:16:15,10:17:29,0:01:14,0:01:40
28/01/2026,10:17:52,10:18:03,0:00:11,0:01:51
28/01/2026,-,11:20:01,0:47:11,0:49:03
28/01/2026,11:21:18,11:21:48,0:00:30,0:49:33
28/01/2026,11:23:33,11:27:07,0:03:34,0:53:07
28/01/2026,11:48:07,11:50:59,0:02:52,0:56:00
29/01/2026,08:05:41,08:06:55,0:01:14,0:57:14
29/01/2026,08:35:10,08:35:45,0:00:35,0:57:49
29/01/2026,08:39:10,08:42:01,0:02:51,1:00:40
30/01/2026,09:15:00,09:20:00,0:05:00,1:05:40`;

        const parseTime = (str) => {
            if (!str || str === '-' || typeof str !== 'string') return 0;
            const parts = str.trim().split(':').map(Number);
            if (parts.length === 3) return (parts[0] * 3600 + parts[1] * 60 + parts[2]);
            if (parts.length === 2) return (parts[0] * 60 + parts[1]);
            return 0;
        };

        const formatDuration = (sec) => {
            if (!sec || isNaN(sec)) return "0 à¸§.";
            const h = Math.floor(sec / 3600);
            const m = Math.floor((sec % 3600) / 60);
            const s = sec % 60;
            return h > 0 ? `${h}à¸Šà¸¡. ${m}à¸™.` : m > 0 ? `${m}à¸™. ${s}à¸§.` : `${s}à¸§.`;
        };

        const convertDateFormat = (thaiDate) => {
            if (!thaiDate || !thaiDate.includes('/')) return '';
            const parts = thaiDate.split('/');
            if (parts.length !== 3) return '';
            const [d, m, y] = parts;
            return `${y}-${m.padStart(2, '0')}-${d.padStart(2, '0')}`;
        };

        function App() {
            const [data, setData] = useState([]);
            const [darkMode, setDarkMode] = useState(true);
            const [startDate, setStartDate] = useState('');
            const [endDate, setEndDate] = useState('');
            const [error, setError] = useState(null);

            useEffect(() => {
                if (darkMode) document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            }, [darkMode]);

            const processCSVData = (text) => {
                try {
                    setError(null);
                    const rows = text.split(/\r?\n/).filter(r => r.trim());
                    if (rows.length < 2) throw new Error("à¹„à¸Ÿà¸¥à¹Œà¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥");
                    
                    const parsed = rows.slice(1).map((row, idx) => {
                        const cols = row.split(',').map(c => c.trim().replace(/"/g, ''));
                        return {
                            id: idx,
                            date: cols[0],
                            isoDate: convertDateFormat(cols[0]),
                            stop: cols[1],
                            start: cols[2],
                            dur: cols[3],
                            cum: cols[4],
                            durSec: parseTime(cols[3])
                        };
                    }).filter(item => item.isoDate !== '');

                    if (parsed.length === 0) throw new Error("à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸­à¹ˆà¸²à¸™à¸£à¸¹à¸›à¹à¸šà¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰");
                    
                    setData(parsed);
                    const sorted = [...parsed].sort((a, b) => a.isoDate.localeCompare(b.isoDate));
                    setStartDate(sorted[0].isoDate);
                    setEndDate(sorted[sorted.length - 1].isoDate);
                } catch (err) {
                    console.error("Data Process Error:", err);
                    setError(err.message);
                }
            };

            useEffect(() => {
                processCSVData(INITIAL_CSV);
            }, []);

            const filteredData = useMemo(() => {
                return data.filter(item => {
                    return (!startDate || item.isoDate >= startDate) && (!endDate || item.isoDate <= endDate);
                }).sort((a, b) => a.isoDate.localeCompare(b.isoDate));
            }, [data, startDate, endDate]);

            const stats = useMemo(() => {
                const totalSec = filteredData.reduce((acc, curr) => acc + curr.durSec, 0);
                return {
                    count: filteredData.length,
                    total: formatDuration(totalSec),
                    avg: formatDuration(filteredData.length > 0 ? Math.round(totalSec / filteredData.length) : 0),
                    max: formatDuration(filteredData.length > 0 ? Math.max(...filteredData.map(d => d.durSec)) : 0)
                };
            }, [filteredData]);

            const dailyData = useMemo(() => {
                const groups = filteredData.reduce((acc, item) => {
                    acc[item.date] = (acc[item.date] || 0) + item.durSec;
                    return acc;
                }, {});
                return Object.keys(groups).map(date => ({ date, total: groups[date] }));
            }, [filteredData]);

            if (error) {
                return e('div', { className: "flex flex-col items-center justify-center min-h-screen p-4 text-center" }, [
                    e('h1', { className: "text-2xl font-bold text-rose-500 mb-2" }, "à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥"),
                    e('p', { className: "text-slate-500 mb-4" }, error),
                    e('button', { 
                        onClick: () => processCSVData(INITIAL_CSV),
                        className: "bg-blue-600 text-white px-6 py-2 rounded-xl"
                    }, "à¸¥à¸­à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¸¡à¹ˆ")
                ]);
            }

            return e('div', { className: "max-w-7xl mx-auto p-4 md:p-8 space-y-8" }, [
                // Header
                e('header', { className: "flex flex-col md:flex-row justify-between items-start md:items-center gap-4" }, [
                    e('div', null, [
                        e('h1', { className: "header-font text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-500 dark:from-blue-400 dark:to-emerald-400" }, "GEN LOG MONITORING"),
                        e('p', { className: "text-slate-500 text-sm" }, "à¸£à¸°à¸šà¸šà¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸à¸³à¹€à¸™à¸´à¸”à¹„à¸Ÿà¸Ÿà¹‰à¸²")
                    ]),
                    e('div', { className: "flex items-center gap-3" }, [
                        e('div', { className: "glass p-2 rounded-xl flex gap-2" }, [
                            e('input', { type: 'date', value: startDate, onChange: e => setStartDate(e.target.value), className: "bg-transparent text-xs outline-none" }),
                            e('span', null, "â†’"),
                            e('input', { type: 'date', value: endDate, onChange: e => setEndDate(e.target.value), className: "bg-transparent text-xs outline-none" })
                        ]),
                        e('button', { onClick: () => setDarkMode(!darkMode), className: "glass p-2 rounded-xl" }, darkMode ? "â˜€ï¸" : "ðŸŒ™")
                    ])
                ]),

                // Summary
                e('div', { className: "grid grid-cols-2 lg:grid-cols-4 gap-4" }, [
                    { label: "à¸ˆà¸³à¸™à¸§à¸™à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¸”à¸±à¸š", val: stats.count, unit: "à¸„à¸£à¸±à¹‰à¸‡", color: "from-blue-500 to-blue-600" },
                    { label: "à¹€à¸§à¸¥à¸²à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”", val: stats.total, unit: "", color: "from-indigo-500 to-indigo-600" },
                    { label: "à¸„à¹ˆà¸²à¹€à¸‰à¸¥à¸µà¹ˆà¸¢/à¸„à¸£à¸±à¹‰à¸‡", val: stats.avg, unit: "", color: "from-emerald-500 to-emerald-600" },
                    { label: "à¸”à¸±à¸šà¸™à¸²à¸™à¸ªà¸¸à¸”", val: stats.max, unit: "", color: "from-rose-500 to-rose-600" }
                ].map(s => e('div', { key: s.label, className: `p-6 rounded-3xl bg-gradient-to-br ${s.color} text-white shadow-lg` }, [
                    e('p', { className: "text-white/70 text-[10px] font-bold uppercase mb-1" }, s.label),
                    e('h3', { className: "text-2xl font-bold" }, s.val),
                    e('p', { className: "text-[10px] opacity-50" }, s.unit)
                ]))),

                // Charts
                e('div', { className: "grid grid-cols-1 lg:grid-cols-3 gap-6" }, [
                    e('div', { className: "lg:col-span-2 glass p-6 rounded-[2rem]" }, [
                        e('h3', { className: "font-bold mb-6" }, "à¹à¸™à¸§à¹‚à¸™à¹‰à¸¡à¹€à¸§à¸¥à¸²à¸—à¸µà¹ˆà¸”à¸±à¸š (à¸§à¸´à¸™à¸²à¸—à¸µ)"),
                        e('div', { className: "h-[300px]" }, e(ResponsiveContainer, null, e(AreaChart, { data: filteredData }, [
                            e(CartesianGrid, { strokeDasharray: "3 3", vertical: false, stroke: "#cbd5e133" }),
                            e(XAxis, { dataKey: "stop", fontSize: 10 }),
                            e(YAxis, { fontSize: 10 }),
                            e(Tooltip),
                            e(Area, { type: "monotone", dataKey: "durSec", stroke: "#3b82f6", fill: "#3b82f633", strokeWidth: 3 })
                        ])))
                    ]),
                    e('div', { className: "glass p-6 rounded-[2rem]" }, [
                        e('h3', { className: "font-bold mb-6" }, "à¸ªà¸£à¸¸à¸›à¸£à¸§à¸¡à¸£à¸²à¸¢à¸§à¸±à¸™"),
                        e('div', { className: "h-[300px]" }, e(ResponsiveContainer, null, e(BarChart, { data: dailyData }, [
                            e(XAxis, { dataKey: "date", fontSize: 10 }),
                            e(Tooltip),
                            e(Bar, { dataKey: "total", fill: "#6366f1", radius: [10, 10, 10, 10] })
                        ])))
                    ])
                ]),

                // Table
                e('div', { className: "glass rounded-[2rem] overflow-hidden" }, [
                    e('div', { className: "overflow-x-auto" }, e('table', { className: "w-full text-left" }, [
                        e('thead', { className: "bg-slate-100/50 dark:bg-slate-800/50 text-[10px] font-bold uppercase" }, e('tr', null, 
                            ['à¸§à¸±à¸™à¸—à¸µà¹ˆ', 'à¹€à¸§à¸¥à¸²à¸”à¸±à¸š', 'à¹€à¸§à¸¥à¸²à¸•à¸´à¸”', 'à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²', 'à¸ªà¸°à¸ªà¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”'].map(h => e('th', { className: "px-8 py-4" }, h))
                        )),
                        e('tbody', { className: "divide-y divide-slate-100 dark:divide-slate-800" }, filteredData.slice().reverse().map(r => e('tr', { key: r.id, className: "text-sm hover:bg-blue-50/30 transition-colors" }, [
                            e('td', { className: "px-8 py-4 font-medium" }, r.date),
                            e('td', { className: "px-8 py-4 text-slate-500" }, r.stop),
                            e('td', { className: "px-8 py-4 text-slate-500" }, r.start),
                            e('td', { className: "px-8 py-4 font-bold text-rose-500" }, r.dur),
                            e('td', { className: "px-8 py-4 font-bold text-blue-500" }, r.cum)
                        ])))
                    ]))
                ])
            ]);
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(e(App));
    </script>
</body>
</html>
