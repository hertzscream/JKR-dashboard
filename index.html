<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Log Dashboard</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Recharts (Legacy Support Version) -->
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap');
        body { 
            font-family: 'Sarabun', sans-serif; 
            margin: 0;
            padding: 0;
            background-color: #f8fafc;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #6366f1;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div id="root">
        <!-- Static Fallback during load -->
        <div style="display: flex; height: 100vh; width: 100%; align-items: center; justify-content: center; background: #f8fafc;">
            <div style="text-align: center;">
                <div class="loading-spinner" style="margin: 0 auto;"></div>
                <p style="margin-top: 15px; color: #64748b;">กำลังโหลดระบบ Dashboard...</p>
            </div>
        </div>
    </div>

    <script>
        // --- React Hooks and Components Shortcut ---
        const { useState, useEffect, useMemo } = React;
        const e = React.createElement; // Helper for Vanilla JS React

        // --- SVG Icons (No library dependency) ---
        const Icon = ({ name, className = "w-5 h-5" }) => {
            const icons = {
                activity: `<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>`,
                clock: `<circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>`,
                calendar: `<rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>`,
                alert: `<circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line>`,
                chevronLeft: `<polyline points="15 18 9 12 15 6"></polyline>`,
                menu: `<line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>`
            };
            return e('svg', {
                dangerouslySetInnerHTML: { __html: icons[name] || '' },
                viewBox: "0 0 24 24",
                fill: "none",
                stroke: "currentColor",
                strokeWidth: "2",
                strokeLinecap: "round",
                strokeLinejoin: "round",
                className: className
            });
        };

        const SAMPLE_DATA = [
            { date: "27/01/2026", stopTime: "16:57:02", startTime: "16:57:20", duration: "0:00:17", cumulative: "0:00:17" },
            { date: "27/01/2026", stopTime: "16:59:00", startTime: "16:59:09", duration: "0:00:08", cumulative: "0:00:26" },
            { date: "28/01/2026", stopTime: "10:16:15", startTime: "10:17:29", duration: "0:01:14", cumulative: "0:01:40" },
            { date: "28/01/2026", stopTime: "10:17:52", startTime: "10:18:03", duration: "0:00:11", cumulative: "0:01:51" },
            { date: "28/01/2026", stopTime: "11:20:00", startTime: "11:20:01", duration: "0:47:11", cumulative: "0:49:03" },
            { date: "28/01/2026", stopTime: "11:21:18", startTime: "11:21:48", duration: "0:00:30", cumulative: "0:49:33" },
            { date: "28/01/2026", stopTime: "11:23:33", startTime: "11:27:07", duration: "0:03:34", cumulative: "0:53:07" },
            { date: "28/01/2026", stopTime: "11:48:07", startTime: "11:50:59", duration: "0:02:52", cumulative: "0:56:00" },
        ];

        function App() {
            const [data, setData] = useState([]);
            const [selectedDate, setSelectedDate] = useState('All');
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);

            useEffect(() => {
                const parseSec = (str) => {
                    if (!str || str === '-') return 0;
                    const p = str.split(':').map(Number);
                    return p.length === 3 ? p[0]*3600+p[1]*60+p[2] : (p.length === 2 ? p[0]*60+p[1] : 0);
                };
                setData(SAMPLE_DATA.map((d, i) => ({ ...d, id: i, durationSec: parseSec(d.duration) })));
            }, []);

            const filtered = useMemo(() => selectedDate === 'All' ? data : data.filter(d => d.date === selectedDate), [data, selectedDate]);
            const dates = useMemo(() => ['All', ...new Set(data.map(d => d.date))], [data]);

            const stats = useMemo(() => {
                const totalSec = filtered.reduce((a, b) => a + b.durationSec, 0);
                return {
                    count: filtered.length,
                    totalTime: totalSec > 3600 ? Math.floor(totalSec/60) + " นาที" : totalSec + " วิ",
                    avg: Math.round(totalSec / (filtered.length || 1)) + " วิ",
                    max: filtered.reduce((a, b) => b.durationSec > a ? b.durationSec : a, 0) + " วิ"
                };
            }, [filtered]);

            // Main Component UI using e()
            return e('div', { className: "min-h-screen flex" }, [
                // Sidebar
                e('aside', { key: 'side', className: `bg-slate-900 text-white transition-all fixed h-full z-30 ${isSidebarOpen ? 'w-64' : 'w-20'}` }, [
                    e('div', { className: "p-6 border-b border-slate-800 flex items-center justify-between" }, [
                        isSidebarOpen && e('span', { className: "font-bold text-xl" }, "GEN LOG"),
                        e('button', { onClick: () => setIsSidebarOpen(!isSidebarOpen), className: "p-2 hover:bg-slate-800 rounded-lg mx-auto" }, [
                            e(Icon, { name: isSidebarOpen ? 'chevronLeft' : 'menu' })
                        ])
                    ]),
                    e('div', { className: "p-4 space-y-4" }, [
                        isSidebarOpen && e('label', { className: "text-xs font-bold text-slate-500 uppercase px-2" }, "ตัวกรองวันที่"),
                        dates.map(d => e('div', {
                            key: d,
                            onClick: () => setSelectedDate(d),
                            className: `flex items-center gap-3 px-3 py-2 rounded-lg cursor-pointer transition ${selectedDate === d ? 'bg-indigo-600 text-white' : 'hover:bg-slate-800 text-slate-400'}`
                        }, [
                            e(Icon, { name: 'calendar', className: "w-4 h-4" }),
                            isSidebarOpen && e('span', { className: "text-sm" }, d === 'All' ? 'แสดงทั้งหมด' : d)
                        ]))
                    ])
                ]),
                // Main
                e('main', { key: 'main', className: `flex-1 transition-all ${isSidebarOpen ? 'ml-64' : 'ml-20'} p-8 bg-slate-50` }, [
                    e('div', { className: "max-w-7xl mx-auto space-y-8 fade-in" }, [
                        e('header', null, [
                            e('h1', { className: "text-3xl font-bold text-slate-900" }, "Generator Dashboard"),
                            e('p', { className: "text-slate-500" }, `สรุปข้อมูลการขัดข้อง (${selectedDate})`)
                        ]),
                        // Cards
                        e('div', { className: "grid grid-cols-1 md:grid-cols-4 gap-6" }, [
                            { t: 'เครื่องดับ', v: stats.count + ' ครั้ง', i: 'activity', c: 'text-indigo-600' },
                            { t: 'ระยะเวลารวม', v: stats.totalTime, i: 'clock', c: 'text-rose-600' },
                            { t: 'เฉลี่ยต่อครั้ง', v: stats.avg, i: 'activity', c: 'text-amber-600' },
                            { t: 'ดับนานสุด', v: stats.max, i: 'alert', c: 'text-indigo-600' }
                        ].map(s => e('div', { key: s.t, className: "bg-white p-6 rounded-2xl shadow-sm border border-slate-200" }, [
                            e('p', { className: "text-xs font-bold text-slate-400 uppercase" }, s.t),
                            e('h3', { className: `text-2xl font-bold mt-2 ${s.c}` }, s.v)
                        ]))),
                        // Table
                        e('div', { className: "bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden" }, [
                            e('div', { className: "p-6 border-b border-slate-100 font-bold text-slate-700" }, "บันทึกเหตุการณ์"),
                            e('div', { className: "overflow-x-auto" }, [
                                e('table', { className: "w-full text-left" }, [
                                    e('thead', { className: "bg-slate-50 text-xs text-slate-400 uppercase" }, [
                                        e('tr', null, ['วันที่', 'เวลาดับ', 'เวลาติด', 'ระยะเวลา', 'สถานะ'].map(h => e('th', { key: h, className: "px-6 py-4" }, h)))
                                    ]),
                                    e('tbody', { className: "text-sm" }, filtered.map(row => e('tr', { key: row.id, className: "border-b border-slate-50 hover:bg-slate-50" }, [
                                        e('td', { className: "px-6 py-4 font-medium" }, row.date),
                                        e('td', { className: "px-6 py-4" }, row.stopTime),
                                        e('td', { className: "px-6 py-4" }, row.startTime),
                                        e('td', { className: "px-6 py-4 font-bold" }, row.duration),
                                        e('td', { className: "px-6 py-4" }, [
                                            e('span', { className: `px-2 py-1 rounded-full text-[10px] font-bold ${row.durationSec > 60 ? 'bg-rose-100 text-rose-600' : 'bg-emerald-100 text-emerald-600'}` }, 
                                            row.durationSec > 60 ? 'WARNING' : 'NORMAL')
                                        ])
                                    ])))
                                ])
                            ])
                        ])
                    ])
                ])
            ]);
        }

        // Wait for DOM
        window.onload = () => {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(e(App));
        };
    </script>
</body>
</html>
